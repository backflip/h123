function getOutline(){for(var e=0,t=document.querySelectorAll('h1,h2,h3,h4,h5,h6,h7,[role="heading"]'),i=[],o=0;o<t.length;o++){var n=t[o],l=isVisible(t[o]),r=parseInt("heading"==n.getAttribute("role")&&n.getAttribute("aria-level")||n.nodeName.substr(1));if(l){var a=r>e&&r!==e+1;e=r}else a=!1;i.push({visible:l,visuallyhidden:l&&isVisuallyHidden(n),wrong:a,level:r,el:n})}return i}function countOutline(e,t){for(var i=0,o=0;o<e.length;o++)e[o][t]&&i++;return i}function outlineToHTML(e){for(var t="",i=0;i<e.length;i++){var o=e[i],n=o.el;t+='<li class="',t+=o.wrong?"wrong-level":"correct-level",t+=o.visible?"":" hidden",t+=o.visuallyhidden?" visuallyhidden":"",t+='" style="margin-left: '+o.level+'em;">',t+='<a href="#'+i+'" target="_top">',t+='<span class="level" data-level="'+o.level+'"></span> ',t+='<span class="text">'+htmlEntities(n.textContent.replace(/\s+/g," "))+"</span>",t+="</a>",t+="</li>"}return"<ul>"+t+"</ul>"}function htmlEntities(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function isVisible(e){for(var t=window.getComputedStyle(e),i=!1;e;){if("none"===t.display)return!1;if(!i){if("hidden"===t.visibility)return!1;"visible"===t.visibility&&(i=!0)}if("true"===e.getAttribute("aria-hidden"))return!1;e=e.parentElement;try{t=window.getComputedStyle(e)}catch(e){return!0}}return!0}function isVisuallyHidden(e){var t=e.getBoundingClientRect(e);if("absolute"===window.getComputedStyle(e).position){if(t.width<=1&&t.height<=1)return!0;if(t.right<=0)return!0}}function highlightElement(e){e.scrollIntoViewIfNeeded?e.scrollIntoViewIfNeeded():e.scrollIntoView&&e.scrollIntoView(),setTimeout(function(){for(var t=e.getBoundingClientRect(),i=e.parentElement;!t.height&&!t.width&&!t.left&&!t.top&&i;)t=i.getBoundingClientRect(),!1,i=i.parentElement;i&&((t={left:t.left,top:t.top,bottom:t.bottom,right:t.right}).left=Math.min(window.innerWidth,t.left),t.right=Math.max(0,t.right),t.top=Math.min(window.innerHeight,t.top),t.bottom=Math.max(0,t.bottom),document.getElementById(highlighterEl.id)||document.body.appendChild(highlighterEl),highlighterEl.style.left=t.left-10+"px",highlighterEl.style.width=t.right-t.left+20+"px",highlighterEl.style.top=t.top-10+"px",highlighterEl.style.height=t.bottom-t.top+20+"px",highlighterEl.style.display="block")},100)}var containerId="a11y-bookmarklet",containerStyle="position: fixed; top: 0; right: 0; bottom: 0; box-shadow: 0 0 80px rgba(0,0,0,0.3); width: 20%; min-width: 320px; max-width: 450px; z-index: 1000001;",highlighterEl=document.createElement("DIV");highlighterEl.id="h1-a11y-highlighterelement",highlighterEl.style.cssText="pointer-events: none; position: fixed; border: 1px dashed #0081BE; box-shadow: 0 0 54px 0 rgba(0,84,150,0.3); display: none; z-index: 1000000; transition: all 200ms;";var container=document.getElementById(containerId);container&&document.body.removeChild(container),(container=document.createElement("DIV")).id=containerId,container.style.cssText=containerStyle;var iframe=document.createElement("IFRAME");iframe.style.width="100%",iframe.style.height="100%",iframe.style.borderWidth="0";var outline=getOutline();container.appendChild(iframe),iframe.onload=function(){function e(e,i){var o=t.getElementById(e),n=t.querySelector(".result");if(o){var l=function(e){o.checked?n.classList.add(i):n.classList.remove(i)};o.addEventListener("change",l,!1),o.addEventListener("click",l,!1),l()}}iframe.onload=function(){};var t=iframe.contentWindow.document;t.open(),t.write('<html> <head> <meta name="viewport" content="width=device-width,minimum-scale=1.0,initial-scale=1,user-scalable=yes"> <style> * { margin: 0; padding: 0; border: 0; } body { padding: 0; margin: 0; font: 14px/1.6 sans; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"; line-height: 1.6; color: #284900; background: rgba(255,255,255,0.95); } body { white-space: nowrap; overflow-x: hidden; text-overflow: ellipsis; padding: 15px; } ul { margin: 0 0 0 -10px; padding: 0; } li { color: #284900; list-style: none; margin-left: 20px; display: -webkit-box; display: -ms-flexbox; display: flex; } a { color: inherit; text-decoration: none; display: inline-block; max-width: 30em; overflow: hidden; text-overflow: ellipsis; padding: 2px 4px 2px 25px; position: relative; line-height: 1.3; border-radius: 3px; } a > .level { display: inline-block; background-color: currentColor; font-size: 85%; font-weight: bold; width: 2.7ex; height: 2.7ex; text-align: center; -webkit-box-sizing: border-box; box-sizing: border-box; position: absolute; left: 2px; top: 2px; padding-top: 1px; } a > .level:before { content: attr(data-level); color: white; } li.hidden { color: black; text-decoration: line-through; opacity: 0.5; } .result:not(.show-hidden) li.hidden { display: none; } .result.mark-visuallyhidden li.visuallyhidden .level:before { color: inherit; } .result.mark-visuallyhidden li.visuallyhidden .level { border: 1px dashed; background: white; } li.wrong-level { color: #AF3A37; } a:hover { background-color: currentColor; } a:hover > .text { color: white; } a:hover > .level { background-color: transparent; } header { padding-top: 5px; padding-bottom: 15px; padding-right: 5em; margin-bottom: 1em; border-bottom: 1px solid #eee; } legend { margin-right: 1em; font-weight: bold; } @media (min-width: 340px) { legend { float: left; } } .options { display: -webkit-box; display: -ms-flexbox; display: flex; -ms-flex-wrap: wrap; flex-wrap: wrap; } .options .input { margin-right: 2em; } .count { background: #ddd; border-radius: 4px; padding: 1px 3px; } .tooltip { position: relative; } .tooltip:before { content: \'ℹ️\'; } .tooltip:focus:after, .tooltip:hover:after { content: attr(title); position: absolute; background: white; padding: 4px 10px; top: 70%; left: 70%; width: 10em; -webkit-box-shadow: 0 2px 20px rgba(0,0,0,0.3); box-shadow: 0 2px 20px rgba(0,0,0,0.3); white-space: normal; border-radius: 8px; border-top-left-radius: 0; z-index: 1; pointer-events: none; } .button-close { position: absolute; top: 15px; right: 15px; padding: 5px 10px; border-radius: 5px; border: 0; font-size: inherit; color: white; background-color: #284900; cursor: pointer; } .button-close:hover { color: white; background-color: #284900; } </style> </head> <body> <header> <button class="button-close" data-action="close">Close</button> <fieldset> <legend>Options</legend> <div class="options"> <div class="input"> <input type="checkbox" name="options" id="o-hidden"> <label for="o-hidden">Show hidden <span class="count" id="o-hidden-count"></span> <span class="tooltip" title="also hidden for screenreaders" tabindex="0"></span></label> </div> <div class="input"> <input type="checkbox" name="options" id="o-visuallyhidden"> <label for="o-visuallyhidden">Mark visually hidden <span class="count" id="o-visuallyhidden-count"></span> <span class="tooltip" title="only visible for screenreaders" tabindex="0"></span></label> </div> </div> </fieldset> </header> <main id="result" class="result"> </main> </body> </html> '),t.close();var i=t.querySelector('[data-action="close"]');i&&i.addEventListener("click",function(e){document.body.removeChild(container),document.getElementById(highlighterEl.id)&&document.body.removeChild(highlighterEl)});var o=t.querySelector("#result");o&&(o.innerHTML=outlineToHTML(outline)),(o=t.querySelector("#o-hidden-count"))&&(o.innerText=countOutline(outline,"hidden")),(o=t.querySelector("#o-visuallyhidden-count"))&&(o.innerText=countOutline(outline,"visuallyhidden")),e("o-hidden","show-hidden"),e("o-visuallyhidden","mark-visuallyhidden"),t.addEventListener("mouseover",function(e){var t;if("A"===e.target.nodeName.toUpperCase()?t=e.target:e.target.parentElement&&"A"===e.target.parentElement.nodeName.toUpperCase()&&(t=e.target.parentElement),t){var i=parseInt(t.getAttribute("href").substr(1),10);highlightElement(outline[i].el)}},!1)},document.body.appendChild(container);